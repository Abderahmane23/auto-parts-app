<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0066cc">
    <title>Pi√®ces Auto Market</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8f9fa;
            padding-bottom: 80px;
        }
        
        /* Header */
        .header {
            background: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            margin: 15px 20px;
        }
        
        .search-bar {
            width: 100%;
            padding: 15px 45px;
            border: none;
            border-radius: 25px;
            background: #f1f3f5;
            font-size: 1em;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #868e96;
            font-size: 1.2em;
        }
        
        /* Category Filters */
        .categories {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .categories::-webkit-scrollbar {
            display: none;
        }
        
        .category-btn {
            padding: 10px 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
            font-size: 0.95em;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-btn.active {
            background: black;
            color: white;
            border-color: black;
        }
        
        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 0 15px;
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .product-card:active {
            transform: scale(0.98);
        }
        
        .product-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            background: #f8f9fa;
        }
        
        .product-info {
            padding: 12px;
        }
        
        .product-code {
            font-size: 0.75em;
            color: #868e96;
            margin-bottom: 5px;
        }
        
        .product-name {
            font-size: 0.9em;
            font-weight: 500;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
        }
        
        .product-price {
            font-size: 1em;
            font-weight: 600;
            color: #000;
        }
        
        /* Load More Button */
        .load-more-container {
            padding: 20px;
            text-align: center;
        }
        
        .load-more-btn {
            width: 100%;
            padding: 15px;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
        }
        
        .load-more-btn:active {
            background: #0052a3;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #868e96;
            font-size: 0.75em;
            text-decoration: none;
        }
        
        .nav-item.active {
            color: #0066cc;
        }
        
        .nav-icon {
            font-size: 1.5em;
        }
        
        /* Product Detail Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal.active {
            display: block;
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .back-btn {
            font-size: 1.5em;
            background: none;
            border: none;
            cursor: pointer;
            margin-right: 15px;
        }
        
        .modal-title {
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .detail-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            background: #f8f9fa;
        }
        
        .detail-content {
            padding: 20px;
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }
        
        .detail-code {
            font-size: 0.85em;
            color: #868e96;
        }
        
        .detail-name {
            font-size: 1.3em;
            font-weight: 600;
            margin: 10px 0 20px 0;
        }
        
        .detail-price {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 0.9em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        
        .detail-description {
            color: #495057;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .detail-info {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-item {
            flex: 1;
        }
        
        .info-label {
            font-size: 0.85em;
            color: #868e96;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            padding: 20px;
            position: sticky;
            bottom: 0;
            background: white;
            border-top: 1px solid #e9ecef;
        }
        
        .btn-acheter {
            flex: 1;
            padding: 15px;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-appeler {
            flex: 1;
            padding: 15px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #868e96;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üöó Pi√®ces Auto Market</h1>
    </div>
    
    <!-- Search Bar -->
    <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-bar" placeholder="Rechercher (code, nom)..." id="searchInput">
    </div>
    
    <!-- Category Filters -->
    <div class="categories" id="categories">
        <button class="category-btn active" data-category="all">Tout</button>
    </div>
    
    <!-- Products Grid -->
    <div class="products-grid" id="productsGrid">
        <div class="loading">‚è≥ Chargement des produits...</div>
    </div>
    
    <!-- Load More Button -->
    <div class="load-more-container" id="loadMoreContainer" style="display:none;">
        <button class="load-more-btn" id="loadMoreBtn">
            Charger plus (<span id="remainingCount">0</span> restants)
        </button>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="#" class="nav-item active">
            <span class="nav-icon">üè†</span>
            <span>Accueil</span>
        </a>
        <a href="#" class="nav-item">
            <span class="nav-icon">üìÇ</span>
            <span>Cat√©gories</span>
        </a>
        <a href="#" class="nav-item">
            <span class="nav-icon">üõí</span>
            <span>Panier</span>
        </a>
        <a href="#" class="nav-item">
            <span class="nav-icon">üë§</span>
            <span>Compte</span>
        </a>
    </div>
    
    <!-- Product Detail Modal -->
    <div class="modal" id="productModal">
        <div class="modal-header">
            <button class="back-btn" id="closeModalBtn">‚Üê</button>
            <span class="modal-title">D√©tails Produit</span>
        </div>
        <img class="detail-image" id="modalImage" src="" alt="">
        <div class="detail-content">
            <div class="detail-header">
                <div>
                    <div class="detail-code" id="modalCode">PI√àCES AUTO</div>
                </div>
            </div>
            <h2 class="detail-name" id="modalName"></h2>
            <div class="detail-price" id="modalPrice"></div>
            
            <div class="section-title">DESCRIPTION</div>
            <p class="detail-description" id="modalDescription"></p>
            
            <div class="detail-info">
                <div class="info-item">
                    <div class="info-label">Cat√©gorie</div>
                    <div class="info-value" id="modalCategory"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">Stock</div>
                    <div class="info-value" id="modalStock"></div>
                </div>
            </div>
        </div>
        <div class="action-buttons">
            <button class="btn-acheter">
                <span>‚ûï</span>
                <span>Acheter</span>
            </button>
            <button class="btn-appeler">
                <span>üí¨</span>
                <span>Appeler</span>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { AppConfig } from './config.js';
        import { 
            fetchProducts, 
            extractCategories, 
            filterByCategory, 
            searchProducts 
        } from './services/api.js';
        import { 
            renderCategories, 
            renderProducts, 
            showProductModal, 
            closeProductModal 
        } from './ui/render.js';

        // State
        let allProducts = [];
        let filteredProducts = [];
        let displayedProducts = [];
        let categories = [];
        let currentCategory = 'all';
        let currentSearch = '';

        // Initialize app
        async function init() {
            try {
                // Fetch products
                allProducts = await fetchProducts();
                filteredProducts = allProducts;
                
                // Extract categories
                categories = extractCategories(allProducts);
                
                // Render categories
                renderCategories(categories, onCategorySelect);
                
                // Display first 10 products
                displayProducts();
                
            } catch (error) {
                document.getElementById('productsGrid').innerHTML = `
                    <div class="loading" style="grid-column: 1/-1;">
                        ‚ùå ${error.message}
                    </div>
                `;
            }
        }

        // Display products (10 at a time initially)
        function displayProducts() {
            displayedProducts = filteredProducts.slice(0, AppConfig.PRODUCTS_PER_PAGE);
            renderProducts(displayedProducts, onProductClick);
            updateLoadMoreButton();
        }

        // Load more products
        function loadMore() {
            const currentCount = displayedProducts.length;
            const nextBatch = filteredProducts.slice(
                currentCount, 
                currentCount + AppConfig.LOAD_MORE_COUNT
            );
            
            displayedProducts = [...displayedProducts, ...nextBatch];
            renderProducts(displayedProducts, onProductClick);
            updateLoadMoreButton();
        }

        // Update Load More button
        function updateLoadMoreButton() {
            const container = document.getElementById('loadMoreContainer');
            const remaining = filteredProducts.length - displayedProducts.length;
            
            if (remaining > 0) {
                container.style.display = 'block';
                document.getElementById('remainingCount').textContent = remaining;
            } else {
                container.style.display = 'none';
            }
        }

        // Category selection handler
        function onCategorySelect(category) {
            currentCategory = category;
            applyFilters();
        }

        // Product click handler
        function onProductClick(product) {
            showProductModal(product);
        }

        // Apply filters (category + search)
        function applyFilters() {
            // Filter by category
            let results = filterByCategory(allProducts, currentCategory);
            
            // Filter by search
            if (currentSearch) {
                results = searchProducts(results, currentSearch);
            }
            
            filteredProducts = results;
            displayProducts();
        }

        // Search input handler
        document.getElementById('searchInput').addEventListener('input', (e) => {
            currentSearch = e.target.value;
            applyFilters();
        });

        // Load more button
        document.getElementById('loadMoreBtn').addEventListener('click', loadMore);

        // Close modal button
        document.getElementById('closeModalBtn').addEventListener('click', closeProductModal);

        // Initialize app
        init();
    </script>

    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(() => console.log('‚úÖ Service Worker registered'))
                .catch(err => console.error('‚ùå SW registration failed:', err));
        }
    </script>
</body>
</html>